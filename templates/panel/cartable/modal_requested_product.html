{% load static %}

<div class="modal fade" id="threeData" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-simple">
        <div class="modal-content p-3 p-md-5">
            <div class="modal-body">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                <div class="text-center mb-4 mt-0 mt-md-n2">
                    <h3 class="mb-2 secondary-font">اطلاعات فروش</h3>
                    <p class="text-muted">
                        جزئیات اطلاعات مرتبط با محصول، مشتری و گزارشات فروش را بررسی نمایید.
                    </p>
                </div>
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="form-check custom-option custom-option-basic">
                            <label class="form-check-label custom-option-content ps-3"
                                   for="customRadioTemp1"
                                   data-bs-target="#clientData"
                                   data-bs-toggle="modal">
                                <input name="customRadioTemp"
                                       class="form-check-input d-none" type="radio"
                                       value="" id="customRadioTemp1">
                                <span class="d-flex align-items-start">
                                    <i class="bx bx-body bx-md me-3 mt-1"></i>
                                    <span>
                                        <span class="custom-option-header">
                                            <span class="h4 mb-2">اطلاعات مشتری</span>
                                        </span>
                                        <span class="custom-option-body">
                                            <span class="mb-0 text-primary">شماره تماس: {{ requested_product_processing.requested_product.customer.phone_number }}</span>
                                        </span>
                                    </span>
                                </span>
                            </label>
                        </div>
                    </div>
                    <div class="col-12 mb-3">
                        <div class="form-check custom-option custom-option-basic">
                            <label class="form-check-label custom-option-content ps-3"
                                   for="customRadioTemp2"
                                   data-bs-target="#productData"
                                   data-bs-toggle="modal">
                                <input name="customRadioTemp"
                                       class="form-check-input d-none" type="radio"
                                       value="" id="customRadioTemp2">
                                <span class="d-flex align-items-start">
                                    <i class="bx bx-category bx-md me-3 mt-1"></i>
                                    <span>
                                        <span class="custom-option-header">
                                            <span class="h4 mb-2">اطلاعات محصول</span>
                                        </span>
                                        <span class="custom-option-body">
                                            <span class="mb-0 text-primary">نام محصول: {{ requested_product_processing.requested_product.product.name }}</span>
                                        </span>
                                    </span>
                                </span>
                            </label>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-check custom-option custom-option-basic">
                            <label class="form-check-label custom-option-content ps-3"
                                   for="customRadioTemp3"
                                   data-bs-target="#reportData"
                                   data-bs-toggle="modal" onclick="get_reports_data('{{ requested_product_processing.id }}')">
                                <input name="customRadioTemp"
                                       class="form-check-input d-none" type="radio"
                                       value="" id="customRadioTemp3">
                                <span class="d-flex align-items-start">
                                    <i class="bx bxs-report bx-md me-3 mt-1"></i>
                                    <span>
                                        <span class="custom-option-header">
                                            <span class="h4 mb-2">گزارشات فروش</span>
                                        </span>
                                    </span>
                                </span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="clientData" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-simple">
        <div class="modal-content p-3 p-md-5">
            <div class="modal-body">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                <div class="text-center mb-2 mt-0 mt-md-n2">
                    <h3 class="mb-0 secondary-font">افزودن برنامه احراز هویت</h3>
                </div>
                <h5 class="mb-2 pt-1 text-break">برنامه‌های احراز هویت</h5>
                <p class="mb-4">
                    با استفاده از یک برنامه احراز هویت مانند Google Authenticator،
                    Microsoft Authenticator، Authy یا 1Password، کد QR را اسکن کنید.
                    یک کد 6 رقمی برای شما ایجاد می کند که در زیر وارد کنید.
                </p>
                <div class="text-center">
                    <img src="{% static 'assets/img/icons/misc/authentication-QR.png' %}"
                         alt="QR Code" width="140">
                </div>
                <div class="alert alert-warning alert-dismissible my-3"
                     role="alert">
                    <h5 class="alert-heading mb-2">ASDLKNASDA9AHS678dGhASD78AB</h5>
                    <p class="mb-0">اگر در استفاده از کد QR مشکل دارید، ورود دستی را
                        در برنامه خود انتخاب کنید</p>
                </div>
                <div class="mb-4">
                    <input type="email" class="form-control" id="twoFactorAuthInput"
                           placeholder="کد احراز هویت را وارد کنید">
                </div>
                <div class="col-12 text-end">
                    <button type="button"
                            class="btn btn-label-secondary me-sm-3 me-1"
                            data-bs-toggle="modal" data-bs-target="#twoFactorAuth">
                        <i class="bx bx-left-arrow-alt bx-xs me-1 scaleX-n1-rtl"></i><span
                            class="align-middle">بازگشت</span>
                    </button>
                    <button type="button" class="btn btn-primary"
                            data-bs-dismiss="modal" aria-label="Close">
                        <span class="align-middle">ادامه</span><i
                            class="bx bx-right-arrow-alt bx-xs ms-1 scaleX-n1-rtl"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="productData" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-simple">
        <div class="modal-content p-3 p-md-5">
            <div class="modal-body">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                <h5 class="mb-2 pt-1">شماره موبایل خود را برای دریافت پیامک تایید
                    کنید</h5>
                <p class="mb-4">
                    شماره تلفن همراه خود را با کد کشور وارد کنید و ما یک کد تایید
                    برای شما ارسال می کنیم.
                </p>
                <div class="mb-4">
                    <input type="text" class="form-control text-start"
                           id="twoFactorAuthInputSms" placeholder="747 875 3459"
                           dir="ltr">
                </div>
                <div class="col-12 text-end">
                    <button type="button"
                            class="btn btn-label-secondary me-sm-3 me-1"
                            data-bs-toggle="modal" data-bs-target="#twoFactorAuth">
                        <i class="bx bx-left-arrow-alt bx-xs me-1 scaleX-n1-rtl"></i><span
                            class="align-middle">بازگشت</span>
                    </button>
                    <button type="button" class="btn btn-primary"
                            data-bs-dismiss="modal" aria-label="Close">
                        <span class="align-middle">ادامه</span><i
                            class="bx bx-right-arrow-alt bx-xs ms-1 scaleX-n1-rtl"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="reportData" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-simple">
        <div class="modal-content p-3 p-md-5">
            <div class="modal-body">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                <h4 id="mrp_reports_count" class="modal-header"></h4>
                <div class="row">
                    <div id="mrp_reports_container" class="col-sm-12 col-md-12 col-lg-12"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function get_reports_data(requested_product_processing_id) {
        const mrp_reports_container = document.getElementById('mrp_reports_container')
        const mrp_reports_count = document.getElementById('mrp_reports_count')
        
        const loading_text = 'در حال بارگذاری ...'
        const loading_html = `<div class="spinner-border spinner-border-md text-light" role="status">
                                  <span class="visually-hidden">${loading_text}</span>
                                </div>`
        const formData = new FormData();
        formData.append('requested_product_processing_id', `${requested_product_processing_id}`)
        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}')
        const options = {
            method: 'POST',
            body: formData,
        }
        mrp_reports_container.innerHTML=loading_html
        fetch('{% url 'panel:requested-product-processing-reports' %}', options)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                mrp_reports_count.innerText=`تعداد گزارشات: ${data['data'].length}`
                mrp_reports_container.innerHTML=`<ul class="timeline timeline-dashed mt-4"></ul>`
                for (let i=0; i < data['data'].length; i++) {
                    mrp_reports_container.firstElementChild.innerHTML += `<li class="timeline-item timeline-item-primary mb-4">
                                <span class="timeline-indicator timeline-indicator-primary">
                                    <i class="bx bx-paper-plane"></i>
                                </span>
                                <div class="timeline-event">
                                    <div class="timeline-header border-bottom mb-3 mt-n1">
                                        <h6 class="mb-1 mb-sm-2">دپارتمان: ${data['data'][i]['department']}</h6>
                                        <small class="text-muted mt-1 mt-sm-0 mb-2 mb-sm-0">${data['data'][i]['created_at']}</small>
                                    </div>
                                    <div class="text mb-2">
                                        <span>${data['data'][i]['report']}</span>
                                    </div>
                                    <a href="javascript:void(0)">
                                        <i class="bx bx-user"></i>
                                        توسط: ${data['data'][i]['created_by']}
                                    </a>
                                </div>
                            </li>`
                }
                console.log(data)
            })
            .catch(error => {
                console.log(error)
            });
    }
</script>